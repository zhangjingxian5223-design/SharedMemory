# React Native ShmProxy

> é«˜æ€§èƒ½ React Native æ•°æ®ä¼ è¾“æ–¹æ¡ˆï¼Œä½¿ç”¨å…±äº«å†…å­˜ï¼ˆShared Memoryï¼‰ä¼˜åŒ–å¤§æ•°æ®ä¼ è¾“

[![npm version](https://badge.fury.io/js/react-native-shmproxy.svg)](https://www.npmjs.com/package/react-native-shmproxy)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Platform](https://img.shields.io/badge/platform-iOS-lightgrey.svg)](https://github.com/yourusername/react-native-shmproxy)

## âœ¨ ç‰¹æ€§

- ğŸš€ **æ€§èƒ½æå‡**: æ¯”ä¼ ç»Ÿ Bridge æ–¹æ³•å¿« **55-68%**
- ğŸ’¾ **é›¶æ‹·è´**: ä½¿ç”¨å…±äº«å†…å­˜é¿å…æ•°æ®å¤åˆ¶
- ğŸ”„ **æ‡’åŠ è½½**: ShmProxyLazy æ”¯æŒæŒ‰éœ€åŠ è½½ï¼Œåªåœ¨è®¿é—®æ—¶è½¬æ¢æ•°æ®
- ğŸ“± **React Native**: å®Œæ•´çš„ TypeScript æ”¯æŒ
- ğŸ”’ **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ç±»å‹å®šä¹‰

## ğŸ“¦ åŒ…å«æ¨¡å—

æœ¬é¡¹ç›®åŒ…å«ä¸¤ä¸ªç‹¬ç«‹ä½†äº’è¡¥çš„æ¨¡å—ï¼š

### ShmProxy

å…¨é‡è½¬æ¢æ–¹æ¡ˆï¼Œé€‚åˆéœ€è¦å®Œæ•´å¯¹è±¡çš„åœºæ™¯ã€‚

- **æ€§èƒ½**: æ¯”ä¼ ç»Ÿæ–¹æ³•å¿« **55-60%**
- **ä½¿ç”¨åœºæ™¯**: éœ€è¦è®¿é—®å¤§éƒ¨åˆ†å­—æ®µ
- **å®ç°**: Shared Memory + JSI å…¨é‡è½¬æ¢

### ShmProxyLazy

æ‡’åŠ è½½æ–¹æ¡ˆï¼Œä½¿ç”¨ ES6 Proxy å®ç°æŒ‰éœ€è®¿é—®ã€‚

- **æ€§èƒ½**: æ¯”ä¼ ç»Ÿæ–¹æ³•å¿« **64-68%** (éƒ¨åˆ†è®¿é—®åœºæ™¯)
- **ä½¿ç”¨åœºæ™¯**: åªè®¿é—®å°‘é‡å­—æ®µï¼Œéœ€è¦æè‡´æ€§èƒ½
- **å®ç°**: ES6 Proxy + Shared Memory + æŒ‰éœ€è½¬æ¢

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### Partial Access (è®¿é—® 4 ä¸ªå­—æ®µ)

| æ•°æ®å¤§å° | Traditional | ShmProxy | ShmProxyLazy | æå‡ |
|---------|-------------|----------|--------------|------|
| 1MB     | 49.97ms     | 21.57ms  | 17.32ms      | â–²65% |
| 5MB     | 256.14ms    | 111.35ms | 91.77ms      | â–²64% |
| 20MB    | 1068.98ms   | 457.71ms | 348.69ms     | â–²67% |

### Full Access (è®¿é—®æ‰€æœ‰å­—æ®µ)

| æ•°æ®å¤§å° | Traditional | ShmProxy | ShmProxyLazy | æå‡ |
|---------|-------------|----------|--------------|------|
| 1MB     | 64.50ms     | 35.05ms  | 36.26ms      | â–²44% |
| 5MB     | 324.92ms    | 183.67ms | 181.99ms     | â–²44% |
| 20MB    | 1293.30ms   | 715.94ms | 714.30ms     | â–²45% |

*æµ‹è¯•ç¯å¢ƒ: iOS Simulator, React Native 0.73.11*

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
# ä½¿ç”¨ npm
npm install react-native-shmproxy

# æˆ–ä½¿ç”¨ yarn
yarn add react-native-shmproxy

# å¦‚æœéœ€è¦æ‡’åŠ è½½åŠŸèƒ½
npm install react-native-shmproxy-lazy
```

### iOS é…ç½®

```bash
cd ios
pod install
```

### åŸºç¡€ä½¿ç”¨

#### ShmProxy

```typescript
import { ShmProxy } from 'react-native-shmproxy';

// 1. å†™å…¥æ•°æ®åˆ°å…±äº«å†…å­˜
const shmKey = await ShmProxy.write({
  song: {
    title: 'Hello World',
    year: 2024,
    segments: [
      { pitches: [440, 880, 1320] },
      { pitches: [523, 1047, 1568] }
    ]
  }
});

// 2. è¯»å–æ•°æ®ï¼ˆå…¨é‡è½¬æ¢ï¼‰
const data = await ShmProxy.read(shmKey);

// 3. ä½¿ç”¨æ•°æ®
console.log(data.song.title); // 'Hello World'
console.log(data.song.segments[0].pitches); // [440, 880, 1320]
```

#### ShmProxyLazy

```typescript
import { ShmProxyLazy } from 'react-native-shmproxy-lazy';

// 1. å†™å…¥æ•°æ®
const shmKey = await ShmProxyLazy.write({
  song: {
    title: 'Hello World',
    year: 2024,
    segments: [...]
  }
});

// 2. åˆ›å»º Proxyï¼ˆæå¿«ï¼Œä¸è½¬æ¢æ•°æ®ï¼‰
const data = ShmProxyLazy.createProxy(shmKey);

// 3. è®¿é—®å­—æ®µï¼ˆåªè½¬æ¢è®¿é—®çš„å­—æ®µï¼‰
console.log(data.song.title); // åªè½¬æ¢ song.title

// 4. å®Œæ•´è®¿é—®ï¼ˆå¦‚æœéœ€è¦ï¼‰
const fullData = await ShmProxyLazy.materialize(shmKey);
```

## ğŸ“– æ–‡æ¡£

- [å®‰è£…æŒ‡å—](./docs/installation.md)
- [API å‚è€ƒ](./docs/api-reference.md)
- [ShmProxy æ–‡æ¡£](./packages/shmproxy/README.md)
- [ShmProxyLazy æ–‡æ¡£](./packages/shmproxy-lazy/README.md)
- [æ¶æ„è®¾è®¡](./docs/architecture.md)
- [æ€§èƒ½åˆ†æ](./docs/performance.md)

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### ä½¿ç”¨ ShmProxy å½“:

âœ… éœ€è¦è®¿é—®å¤§éƒ¨åˆ†å­—æ®µ
âœ… éœ€è¦å®Œæ•´å¯¹è±¡çš„è¯­ä¹‰
âœ… ä»£ç ç®€æ´æ€§ä¼˜å…ˆ

### ä½¿ç”¨ ShmProxyLazy å½“:

âœ… åªè®¿é—®å°‘é‡å­—æ®µï¼ˆ< 20%ï¼‰
âœ… éœ€è¦æè‡´æ€§èƒ½
âœ… å¯ä»¥æ¥å—å¼‚æ­¥è®¿é—®

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     React Native App                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  ShmProxy        â”‚         â”‚  ShmProxyLazy    â”‚         â”‚
â”‚  â”‚  (Full Convert)  â”‚         â”‚  (ES6 Proxy)     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚           â”‚                            â”‚                     â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                      â–¼                                       â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚           â”‚   Shared Memory     â”‚                            â”‚
â”‚           â”‚   (Zero Copy)       â”‚                            â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–²
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Native (iOS)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚           â”‚  NSDictionary       â”‚                            â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                      â–¼                                       â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚           â”‚  SHM Binary Format  â”‚                            â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·æŸ¥çœ‹ [CONTRIBUTING.md](./CONTRIBUTING.md) äº†è§£è¯¦æƒ…ã€‚

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](./LICENSE) æ–‡ä»¶

## ğŸ”— ç›¸å…³é“¾æ¥

- [Shared Memory åŸç†](./docs/architecture.md#shared-memory-format)
- [æ€§èƒ½æµ‹è¯•æ–¹æ³•](./docs/performance.md)
- [å¸¸è§é—®é¢˜](./docs/troubleshooting.md)

## ğŸ™ è‡´è°¢

æœ¬é¡¹ç›®å—ä»¥ä¸‹é¡¹ç›®å¯å‘ï¼š
- [React Native JSI](https://github.com/facebook/react-native/tree/main/packages/react-native/ReactCommon/jsi)
- [shm](https://github.com/waymondrang/shm)

---

**Made with â¤ï¸ by [Your Name]**
